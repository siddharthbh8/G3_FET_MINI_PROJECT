<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="https://img.icons8.com/material/24/000000/image-gallery.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>MI Gallery | Upload Post</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css">

</head>

<body id="page-top">
    <div id="wrapper">
      
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand-lg fixed-top bg-warning">
                    <div class="container-fluid" >
                        <ul class="navbar-nav flex-nowrap ml-auto">
                    <li class="nav-item"><a class="nav-link" href="../homepage/index.html">Home Page</a></li>
                    <li class="nav-item"><a class="nav-link" href="../gallery/gallery.html">Gallery</a></li>
                    <li class="nav-item"><a class="nav-link active" href="upload.html">Upload</a></li>
                    <li class="nav-item"><a class="nav-link" href="profile.html">Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="table.html">History</a></li>
                    
                    </li></ul>
                        <ul class="navbar-nav flex-nowrap ml-auto">

                            <div class="d-none d-sm-block topbar-divider"></div>
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link"
                                        aria-expanded="false" data-toggle="dropdown" href="#"><span
                                        class="d-none d-lg-inline mr-2 font-weight-bold"
                                            id="name-dropdown">Valerie Luna</span>
                                           
                                        </a>
                                    <div class="dropdown-menu shadow dropdown-menu-right animated--grow-in">
                                        <a
                                            class="dropdown-item" href="./profile.html"><em
                                            class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></em>&nbsp;Profile</a><a
                                            class="dropdown-item" href="./table.html"><em
                                                class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></em>&nbsp;Activity
                                            log</a>
                                        
                                        <div class="dropdown-divider"></div><a class="dropdown-item" href="#"
                                            id="logout"><em
                                                class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></em>&nbsp;Logout</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="container-fluid" style="padding-top:5%; padding-left: 40%;">
                    <h3 class="text-dark mb-4  mt-3 " >Please post</h3>
                    
                            <button type="button" class="btn btn-success" data-toggle="modal"
                                data-target="#linkModal" style="margin-left:3%;">Public Post</button>
                            <div class="alert alert-success mt-3" role="alert" id="postSuccess" style="display:none;">
                                Post successful!
                            </div>
                            <div class="alert alert-warning mt-3" role="alert" id="postFail" style="display:none;">
                                Failed to make the post!
                                <ul>
                                    <li id="postempty" style="display:none;">
                                        Post was empty
                                    </li>
                                    <li id="posterr" style="display:none;">
                                        Some internal error occured.
                                    </li>
                                </ul>
                            </div>

                            <!-- Button trigger modal -->


                            <!-- Modal -->
                            <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centred modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="uploadModalLabel">Upload</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <form class="was-validated" id="post-upload-form">
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text"
                                                            id="inputGroupFileAddon01">Upload</span>
                                                    </div>
                                                    <div class="custom-file">
                                                        <input type="file" class="custom-file-input"
                                                            aria-describedby="inputGroupFileAddon01" accept="image/jpeg"
                                                            required id="post-upload-img">
                                                        <label class="custom-file-label" for="inputGroupFile01">Choose
                                                            file</label>
                                                    </div>
                                                </div>
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text"
                                                            id="inputGroup-sizing-default">Title</span>
                                                    </div>
                                                    <input type="text" class="form-control"
                                                        aria-label="Sizing example input"
                                                        aria-describedby="inputGroup-sizing-default"
                                                        id="post-upload-title" required>
                                                </div>
                                                <div class="form-floating">
                                                    <label for="post-upload-desc">Description</label>
                                                    <textarea class="form-control" placeholder="Description"
                                                        id="post-upload-desc" style="height: 100px" required></textarea>
                                                </div>
                                                <div class="form-floating">
                                                    <label for="post-upload-hash">Hashtags</label>
                                                    <textarea class="form-control"
                                                        placeholder="link with relevent hashtags" id="post-upload-hash"
                                                        required></textarea>
                                                </div>
                                                <br>
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-primary" data-dismiss="modal"
                                                        id="post-upload-exec">Post!</button>
                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Close</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="linkModal" tabindex="-1" aria-labelledby="linkModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centred modal-lg">
                                    <div class="modal-content">

                                        <div class="modal-header">
                                            <h5 class="modal-title" id="linkModalLabel">Upload Data</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <form class="was-validated" id="post-link-form">
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text"
                                                            id="inputGroup-sizing-default">Image URL</span>
                                                    </div>
                                                    <input type="url" class="form-control"
                                                        aria-label="Sizing example input"
                                                        aria-describedby="inputGroup-sizing-default" required
                                                        id="post-link-img"
                                                        pattern="^http.*\.(jpg|jpeg|png|jfif|tiff|gif)">
                                                </div>
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text"
                                                            id="inputGroup-sizing-default">Title of the post</span>
                                                    </div>
                                                    <input type="text" class="form-control"
                                                        aria-label="Sizing example input"
                                                        aria-describedby="inputGroup-sizing-default" required
                                                        id="post-link-title">
                                                </div>

                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text"
                                                            id="inputGroup-sizing-default">Description</span>
                                                    </div>
                                                    <textarea class="form-control" placeholder="Description"
                                                        id="post-link-desc" style="height: 100px" required></textarea>
                                                </div>
                                                <div class="input-group mb-3">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text"
                                                            id="inputGroup-sizing-default">Description</span>
                                                    </div>
                                                    <textarea class="form-control"
                                                        placeholder="link with relevent hashtags separated by space"
                                                        id="post-link-hash" required></textarea>
                                                </div>

                                               
                                                <br>
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-success" data-dismiss="modal"
                                                        id="post-link-exec">Post</button>
                                                    <button type="button" class="btn btn-danger"
                                                        data-dismiss="modal">Close</button>
                                                        <button class="btn btn-danger " type="reset" >Clear</button>

                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>



                        
                </div>
            </div>
            <div>
                
            </div>
        </div>
        <a class="border rounded d-inline scroll-to-top" href="#page-top"><em class="fas fa-angle-up"></em></a>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
        integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
    <script src="assets/js/theme.js"></script>


    <script src="./assets/js/session-script.js"></script>

    <script>

        $('#post-link-exec').click(function () {
            const reg = new RegExp("^http.*\.(jpg|jpeg|png|jfif|tiff|gif)")
            if (!reg.test($('#post-link-img').val()) || $('#post-link-title').val() == "" || $('#post-link-desc').val() == "" || $('#post-link-hash').val() == "") {
                $('#postFail').show()
                $('#postempty').show()
                setTimeout(function () {
                    $('#postFail').hide()
                    $('#postempty').hide()

                }, 2000)
                return
            }
            let post = {
                "user_id": userDetails.id,
                "image": $('#post-link-img').val(),
                "date": new Date().toISOString(),
                "title": $('#post-link-title').val(),
                "details": $('#post-link-desc').val(),
                "likes": 0,
                "comments": 0,
                "downloads": 0,
                "hashtags": $('#post-link-hash').val()
            }
            //clear the fields
            clearFields()
            //post 
            $.ajax(
                {
                    method: 'POST',
                    dataType: 'json',
                    url: 'http://localhost:3000/post',
                    data: post,
                    success: () => {
                        $('#postSuccess').show()
                        setTimeout(function () {
                            $('#postSuccess').hide()
                        }, 2000)
                    },
                    error: () => {
                        $('#postFail').show()
                        $('#posterr').show()

                        setTimeout(function () {
                            $('#postFail').hide()
                            $('#posterr').hide()

                        }, 2000)
                    },
                }
            )


        })



        $('#post-upload-exec').click(async function () {
            let img = $('#post-upload-img')[0]
            var file = img.files[0];
            if (!file || $('#post-upload-title').val() == "" || $('#post-upload-desc').val() == "" || $('#post-upload-hash').val() == "") {
                $('#postFail').show()
                $('#postempty').show()
                setTimeout(function () {
                    $('#postFail').hide()
                    $('#postempty').hide()

                }, 2000)
                return
            }
            var reader = new FileReader();
            reader.onloadend = function () {
                let post = {
                    "user_id": userDetails.id,
                    "image": reader.result,
                    "date": new Date().toISOString(),
                    "title": $('#post-upload-title').val(),
                    "details": $('#post-upload-desc').val(),
                    "likes": 0,
                    "comments": 0,
                    "downloads": 0,
                    "hashtags": $('#post-upload-hash').val()
                }
                //post 
                $.ajax(
                    {
                        method: 'POST',
                        dataType: 'json',
                        url: 'http://localhost:3000/post',
                        data: post,
                        success: () => {
                            $('#postSuccess').show()
                            setTimeout(function () {
                                $('#postSuccess').hide()
                            }, 2000)
                        },
                        error: () => {
                            $('#postFail').show()
                            $('#posterr').show()

                            setTimeout(function () {
                                $('#postFail').hide()
                                $('#posterr').hide()

                            }, 2000)

                        },
                    }
                )

            }
            reader.readAsDataURL(file);


            //clear the fields
            clearFields()



        })
        function clearFields() {
            $('#post-link-img').val('')
            $('#post-link-title').val('')
            $('#post-link-desc').val('')
            $('#post-link-hash').val('')
            $('#post-upload-img').val('')
            $('#post-upload-title').val('')
            $('#post-upload-desc').val('')
            $('#post-upload-hash').val('')
        }
    </script>
</body>

</html>